aa_list = str_extract(substitution, "(?<=:)\\S+")
) %>%
filter(type=="sigpep")
weight
weight <- read.csv("substitution_weights_by_timepoint.csv")
weight <- weight %>%
mutate(
type = ifelse(substr(substitution,1,3)=="HA1","ha1", ifelse(substr(substitution,1,3)=="HA2", "ha2", "sigpep")),
aa_list = str_extract(substitution, "(?<=:)\\S+")
)
# per substitution dataset
weight <- read.csv("substitution_weights_by_timepoint.csv")
weight <- weight %>%
mutate(
type = ifelse(substr(substitution,1,3)=="HA1","ha1", ifelse(substr(substitution,1,3)=="HA2", "ha2", "sigpep")),
aa_list = str_extract(substitution, "(?<=:)\\S+"),
season = ifelse(month(timepoint)==10,year(timepoint),year(timepoint)-1)
)
weight
# per substitution dataset
weight <- read.csv("substitution_weights_by_timepoint.csv")
weight <- weight %>%
mutate(
type = ifelse(substr(substitution,1,3)=="HA1","ha1", ifelse(substr(substitution,1,3)=="HA2", "ha2", "sigpep")),
aa_list = str_extract(substitution, "(?<=:)\\S+"),
season = ifelse(month(timepoint)==10,year(timepoint),year(timepoint)-1)
) %>%
filter(month(timepoint)==4)
weight
dt_vax_clade2_long_wt <- dt_vax_clade2_long %>%
left_join(weight, by = c("season","type","aa_list"))
weight <- weight %>%
mutate(
type = ifelse(substr(substitution,1,3)=="HA1","ha1", ifelse(substr(substitution,1,3)=="HA2", "ha2", "sigpep")),
aa_list = str_extract(substitution, "(?<=:)\\S+"),
Season = ifelse(month(timepoint)==10,year(timepoint),year(timepoint)-1)
) %>%
filter(month(timepoint)==4)
# per substitution dataset
weight <- read.csv("substitution_weights_by_timepoint.csv")
weight <- weight %>%
mutate(
type = ifelse(substr(substitution,1,3)=="HA1","ha1", ifelse(substr(substitution,1,3)=="HA2", "ha2", "sigpep")),
aa_list = str_extract(substitution, "(?<=:)\\S+"),
Season = ifelse(month(timepoint)==10,year(timepoint),year(timepoint)-1)
) %>%
filter(month(timepoint)==4)
dt_vax_clade2_long_wt <- dt_vax_clade2_long %>%
left_join(weight, by = c("season","type","aa_list"))
dt_vax_clade2_long_wt <- dt_vax_clade2_long %>%
left_join(weight, by = c("Season","type","aa_list"))
dt_vax_clade2_long_wt
write.csv(dt_vax_clade2_long_wt, "Clade_vax_AA_antgdistance_weight.xlsx")
write.csv(dt_vax_clade2_long_wt, "Clade_vax_AA_antgdistance_weight.csv")
dt_vax_clade2_long_wt <- dt_vax_clade2_long %>%
left_join(weight, by = c("Season","type","aa_list")) %>%
mutate(weight = ifelse(is.na(weight),0,weight))
write.csv(dt_vax_clade2_long_wt, "Clade_vax_AA_antgdistance_weight.csv")
dt_vax_clade2_long_wt
# calculate the total weight per vaccine-clade pair per season
summary_weight <- dt_vax_clade2_long_wt %>%
group_by(Season, clade, vaccine) %>%
summarize(
tot_weight=sum(weight)
)
summary_weight
write.csv(summary_weight, "Total_weight_summary.csv")
library(readxl)
library(tidyverse)
library(usmap)
setwd("/Users/kyueunlee/Library/CloudStorage/OneDrive-UW/My Drive/Z Drive/Project_all/2025_FluSeq")
# built-in state data
state_dt <- data.frame(state = state.name, state_abb = state.abb)
season=2015
print(season)
# clade frequency data
dt <- read_excel(paste0("data/gisaid_epiflu_isolates_",season,".xls"))
dt <- dt %>%
mutate(state = str_extract(Isolate_Name, "(?<=^[A-Z]/)[^/]+"),
date = as.Date(Collection_Date),
month = month(date)) %>%
left_join(state_dt, by="state")
head(dt)
# aa substitution weight data
weight <- read.csv("data/Total_weight_summary.csv")
library(readxl)
library(tidyverse)
library(usmap)
setwd("/Users/kyueunlee/Library/CloudStorage/OneDrive-UW/My Drive/Z Drive/Project_all/2025_FluSeq")
# aa substitution weight data
weight <- read.csv("data/Total_weight_summary.csv")
# built-in state data
state_dt <- data.frame(state = state.name, state_abb = state.abb)
season=2015
# clade frequency data
dt <- read_excel(paste0("data/gisaid_epiflu_isolates_",season,".xls"))
dt <- dt %>%
mutate(state = str_extract(Isolate_Name, "(?<=^[A-Z]/)[^/]+"),
date = as.Date(Collection_Date),
month = month(date)) %>%
left_join(state_dt, by="state")
clade_summary <- dt %>%
group_by(state_abb, Clade) %>%
summarise(
n = n()
) %>%
group_by(state_abb) %>%
mutate(freq = n / sum(n)) %>%
ungroup()
clade_summary
clade_summary <- dt %>%
group_by(state_abb, Clade) %>%
summarise(
n = n()
) %>%
group_by(state_abb) %>%
mutate(freq = n / sum(n),
Season=season) %>%
ungroup()
clade_summary
weight
cal_weight <- clade_summary %>%
left_join(weight, by=c("Season","Clade"="clade"))
cal_weight
head(weight)
head(weight %>% filter(Season==2015))
weight %>% filter(Season==2015)
season=2009
season=2010
# clade frequency data
dt <- read_excel(paste0("data/gisaid_epiflu_isolates_",season,".xls"))
dt <- dt %>%
mutate(state = str_extract(Isolate_Name, "(?<=^[A-Z]/)[^/]+"),
date = as.Date(Collection_Date),
month = month(date)) %>%
left_join(state_dt, by="state")
clade_summary <- dt %>%
group_by(state_abb, Clade) %>%
summarise(
n = n()
) %>%
group_by(state_abb) %>%
mutate(freq = n / sum(n),
Season=season) %>%
ungroup()
cal_weight <- clade_summary %>%
left_join(weight, by=c("Season","Clade"="clade"))
cal_weight
dt <- dt %>%
filter(Clade != "unassigned")%>%
mutate(state = str_extract(Isolate_Name, "(?<=^[A-Z]/)[^/]+"),
date = as.Date(Collection_Date),
month = month(date)) %>%
left_join(state_dt, by="state")
# clade frequency data
dt <- read_excel(paste0("data/gisaid_epiflu_isolates_",season,".xls"))
dt <- dt %>%
filter(Clade != "unassigned")%>%
mutate(state = str_extract(Isolate_Name, "(?<=^[A-Z]/)[^/]+"),
date = as.Date(Collection_Date),
month = month(date)) %>%
left_join(state_dt, by="state")
clade_summary <- dt %>%
group_by(state_abb, Clade) %>%
summarise(
n = n()
) %>%
group_by(state_abb) %>%
mutate(freq = n / sum(n),
Season=season) %>%
ungroup()
cal_weight <- clade_summary %>%
left_join(weight, by=c("Season","Clade"="clade"))
cal_weight
dt <- dt %>%
filter(Clade != "unassigned")%>%
mutate(state = str_extract(Isolate_Name, "(?<=^[A-Z]/)[^/]+"),
date = as.Date(Collection_Date),
month = month(date)) %>%
left_join(state_dt, by="state") %>%
filter(!is.na(state_abb))
# clade frequency data
dt <- read_excel(paste0("data/gisaid_epiflu_isolates_",season,".xls"))
dt <- dt %>%
filter(Clade != "unassigned")%>%
mutate(state = str_extract(Isolate_Name, "(?<=^[A-Z]/)[^/]+"),
date = as.Date(Collection_Date),
month = month(date)) %>%
left_join(state_dt, by="state") %>%
filter(!is.na(state_abb))
clade_summary <- dt %>%
group_by(state_abb, Clade) %>%
summarise(
n = n()
) %>%
group_by(state_abb) %>%
mutate(freq = n / sum(n),
Season=season) %>%
ungroup()
cal_weight <- clade_summary %>%
left_join(weight, by=c("Season","Clade"="clade"))
cal_weight
ggplot(clade_summary , aes(x=state_abb, y=freq, fill=Clade))+
geom_col(position="fill") +
theme_bw() +
scale_y_continuous(expand=c(0,0))+
ggtitle(paste0(season,"-", season+1))+
theme(plot.title = element_text(hjust = 0.5))
clade_summary <- dt %>%
group_by(state_abb, Clade) %>%
summarise(
n = n()
)
clade_summary
# clade frequency data
dt <- read_excel(paste0("data/gisaid_epiflu_isolates_",season,".xls"))
dt <- dt %>%
filter(Clade != "unassigned")%>%
mutate(state = str_extract(Isolate_Name, "(?<=^[A-Z]/)[^/]+"),
date = as.Date(Collection_Date),
month = month(date)) %>%
left_join(state_dt, by="state") %>%
filter(!is.na(state_abb))
dt <- dt %>%
mutate(state = str_extract(Isolate_Name, "(?<=^[A-Z]/)[^/]+"),
date = as.Date(Collection_Date),
month = month(date)) %>%
left_join(state_dt, by="state") %>%
filter(!is.na(state_abb))
clade_summary <- dt %>%
group_by(state_abb, Clade) %>%
summarise(
n = n()
) %>%
group_by(state_abb) %>%
mutate(freq = n / sum(n),
Season=season) %>%
ungroup()
clade_summary
# clade frequency data
dt <- read_excel(paste0("data/gisaid_epiflu_isolates_",season,".xls"))
dt <- dt %>%
mutate(state = str_extract(Isolate_Name, "(?<=^[A-Z]/)[^/]+"),
date = as.Date(Collection_Date),
month = month(date)) %>%
left_join(state_dt, by="state") %>%
filter(!is.na(state_abb))
clade_summary <- dt %>%
group_by(state_abb, Clade) %>%
summarise(
n = n()
) %>%
group_by(state_abb) %>%
mutate(freq = n / sum(n),
Season=season) %>%
ungroup()
clade_summary
cal_weight <- clade_summary %>%
left_join(weight, by=c("Season","Clade"="clade"))
cal_weight
# state data
states <- map_data("state")
state_dt
states <- map_data("state")
states
# built-in state data
state_dt <- data.frame(state = lower(state.name), state_abb = state.abb)
# built-in state data
state_dt <- data.frame(state = tolower(state.name), state_abb = state.abb)
state_dt
states <- map_data("state") %>%
left_join(state_dt, by=c("region"="state") )
states
# clade frequency data
dt <- read_excel(paste0("data/gisaid_epiflu_isolates_",season,".xls"))
head(dt)
dt <- dt %>%
mutate(state = str_extract(Isolate_Name, "(?<=^[A-Z]/)[^/]+"),
date = as.Date(Collection_Date),
month = month(date))
dt$state
# clade frequency data
dt <- read_excel(paste0("data/gisaid_epiflu_isolates_",season,".xls"))
dt <- dt %>%
mutate(state = str_extract(Isolate_Name, "(?<=^[A-Z]/)[^/]+"),
date = as.Date(Collection_Date),
month = month(date))
dt$state
dt <- dt %>%
mutate(state = str_extract(Isolate_Name, "(?<=^[A-Z]/)[^/]+"),
date = as.Date(Collection_Date),
month = month(date)) %>%
left_join(state_dt, by="state") %>%
filter(!is.na(state_abb))
library(readxl)
library(tidyverse)
library(usmap)
library(maps)
setwd("/Users/kyueunlee/Library/CloudStorage/OneDrive-UW/My Drive/Z Drive/Project_all/2025_FluSeq")
# aa substitution weight data
weight <- read.csv("data/Total_weight_summary.csv")
# built-in state data
state_dt <- data.frame(state = state.name, state_abb = state.abb)
season=2019
# clade frequency data
dt <- read_excel(paste0("data/gisaid_epiflu_isolates_",season,".xls"))
dt <- dt %>%
mutate(state = str_extract(Isolate_Name, "(?<=^[A-Z]/)[^/]+"),
date = as.Date(Collection_Date),
month = month(date)) %>%
left_join(state_dt, by="state") %>%
filter(!is.na(state_abb))
clade_summary <- dt %>%
group_by(state_abb, Clade) %>%
summarise(
n = n()
) %>%
group_by(state_abb) %>%
mutate(freq = n / sum(n),
Season=season) %>%
ungroup()
cal_weight <- clade_summary %>%
left_join(weight, by=c("Season","Clade"="clade"))
cal_weight
cal_weight <- clade_summary %>%
left_join(weight, by=c("Season","Clade"="clade")) %>%
mutate(perc_tot_weight = freq*tot_weight)%>%
group_by(state_abb, Season)%>%
summarize(state_tot_weight = sum(perc_tot_weight))
cal_weight
cal_weight %>% filter( state_tot_weight>0)
library(viridis)
# US heatmap with antigenic weights
plot_usmap(
data = cal_weight,
values = "state_tot_weight",
regions = "states"
) +
scale_fill_viridis(
option = "plasma",
name = "Total Weight",
na.value = "grey90"
) +
labs(
title = "US State Heatmap by Weight (Season 2019)",
subtitle = "Each state's total weight value"
) +
theme(legend.position = "right")
cal_weight <- clade_summary %>%
left_join(weight, by=c("Season","Clade"="clade")) %>%
mutate(perc_tot_weight = freq*tot_weight)%>%
group_by(state_abb, Season)%>%
summarize(state_tot_weight = sum(perc_tot_weight))%>%
rename(state = state_abb)
# US heatmap with antigenic weights
plot_usmap(data = df_2019, values = "state_tot_weight") +
scale_fill_viridis(
option = "plasma",
name = "Total Weight",
na.value = "grey90"
) +
labs(
title = "US State Heatmap by Weight (Season 2019)",
subtitle = "Each state's total weight value"
) +
theme(legend.position = "right")
# US heatmap with antigenic weights
plot_usmap(data = cal_weight, values = "state_tot_weight") +
scale_fill_viridis(
option = "plasma",
name = "Total Weight",
na.value = "grey90"
) +
labs(
title = "US State Heatmap by Weight (Season 2019)",
subtitle = "Each state's total weight value"
) +
theme(legend.position = "right")
# US heatmap with antigenic weights
plot_usmap(data = df_2019, values = "state_tot_weight") +
scale_fill_viridis(
option = "plasma",
name = "Total Weight",
na.value = "grey90"
) +
labs(
title = "US State Heatmap by Weight (Season 2019)",
subtitle = "Each state's total weight value"
) +
theme_minimal() +                               # replaces buggy default theme
theme(
legend.position = "right",
panel.background = element_rect(fill = "white", color = NA)
)
# US heatmap with antigenic weights
plot_usmap(data = cal_weight, values = "state_tot_weight") +
scale_fill_viridis(
option = "plasma",
name = "Total Weight",
na.value = "grey90"
) +
labs(
title = "US State Heatmap by Weight (Season 2019)",
subtitle = "Each state's total weight value"
) +
theme_minimal() +                               # replaces buggy default theme
theme(
legend.position = "right",
panel.background = element_rect(fill = "white", color = NA)
)
for (season in seq(2009,2019)){
print(season)
# clade frequency data
dt <- read_excel(paste0("data/gisaid_epiflu_isolates_",season,".xls"))
dt <- dt %>%
mutate(state = str_extract(Isolate_Name, "(?<=^[A-Z]/)[^/]+"),
date = as.Date(Collection_Date),
month = month(date)) %>%
left_join(state_dt, by="state") %>%
filter(!is.na(state_abb))
clade_summary <- dt %>%
group_by(state_abb, Clade) %>%
summarise(
n = n()
) %>%
group_by(state_abb) %>%
mutate(freq = n / sum(n),
Season=season) %>%
ungroup()
cal_weight <- clade_summary %>%
left_join(weight, by=c("Season","Clade"="clade")) %>%
mutate(perc_tot_weight = freq*tot_weight)%>%
group_by(state_abb, Season)%>%
summarize(state_tot_weight = sum(perc_tot_weight))%>%
rename(state = state_abb)
# Distribution of clade/subclade
ggplot(clade_summary , aes(x=state_abb, y=freq, fill=Clade))+
geom_col(position="fill") +
theme_bw() +
scale_y_continuous(expand=c(0,0))+
ggtitle(paste0(season,"-", season+1))+
theme(plot.title = element_text(hjust = 0.5))
ggsave(paste0("graph/clade_distribution_",season,".pdf"),width=7,height=5)
# US heatmap with antigenic weights
plot_usmap(data = cal_weight, values = "state_tot_weight") +
scale_fill_viridis(
option = "plasma",
name = "Total Weight",
na.value = "grey90"
) +
labs(
title = "US State Heatmap by Weight (Season 2019)",
subtitle = "Each state's total weight value"
) +
theme_minimal() +                               # replaces buggy default theme
theme(
legend.position = "right",
panel.background = element_rect(fill = "white", color = NA)
)
ggsave(paste0("graph/weight_distribution_",season,".pdf"),width=7,height=5)
}
for (season in seq(2009,2019)){
print(season)
# clade frequency data
dt <- read_excel(paste0("data/gisaid_epiflu_isolates_",season,".xls"))
dt <- dt %>%
mutate(state = str_extract(Isolate_Name, "(?<=^[A-Z]/)[^/]+"),
date = as.Date(Collection_Date),
month = month(date)) %>%
left_join(state_dt, by="state") %>%
filter(!is.na(state_abb))
clade_summary <- dt %>%
group_by(state_abb, Clade) %>%
summarise(
n = n()
) %>%
group_by(state_abb) %>%
mutate(freq = n / sum(n),
Season=season) %>%
ungroup()
cal_weight <- clade_summary %>%
left_join(weight, by=c("Season","Clade"="clade")) %>%
mutate(perc_tot_weight = freq*tot_weight)%>%
group_by(state_abb, Season)%>%
summarize(state_tot_weight = sum(perc_tot_weight))%>%
rename(state = state_abb)
# Distribution of clade/subclade
ggplot(clade_summary , aes(x=state_abb, y=freq, fill=Clade))+
geom_col(position="fill") +
theme_bw() +
scale_y_continuous(expand=c(0,0))+
ggtitle(paste0(season,"-", season+1))+
theme(plot.title = element_text(hjust = 0.5))
ggsave(paste0("graph/clade_distribution_",season,".pdf"),width=7,height=5)
# US heatmap with antigenic weights
plot_usmap(data = cal_weight, values = "state_tot_weight") +
scale_fill_viridis(
option = "plasma",
name = "Total Weight",
na.value = "grey90"
) +
labs(
title = paste0("Antigenic Weight (Season:)",season),
subtitle = "Each state's total weight value"
) +
theme_minimal() +                               # replaces buggy default theme
theme(
legend.position = "right",
panel.background = element_rect(fill = "white", color = NA)
)
ggsave(paste0("graph/weight_distribution_",season,".pdf"),width=7,height=5)
}
